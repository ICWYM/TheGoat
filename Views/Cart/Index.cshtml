
@{
    ViewData["Title"] = "Cart Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Đoạn giới thiệu trang giỏ hàng -->
<div class="page-style-a">
    <div class="container">
        <div class="page-intro">
            <h2>Giỏ hàng</h2>
            <!--Thông tin bread-crumb -->
            <ul class="bread-crumb">
                <li class="has-separator">
                    <i class="ion ion-md-home"></i>
                    <a asp-controller="Home" asp-action="Index">Trang chủ</a>
                </li>
                <!--Phần Thông tin bread-crumb được đánh dấu -->
                <li class="is-marked">
                    <a asp-controller="Cart" asp-action="Index">Giỏ hàng</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- Đoạn giới thiệu trang giỏ hàng -->
<!-- Nội dung chính của giỏ hàng -->
<!-- Thông tin về các sản phẩm trong giỏ  -->

<div class="page-cart u-s-p-t-80">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="text-center">
                    <h4 style="padding-bottom: 30px" class="section-h4">GIỎ HÀNG CỦA BẠN</h4>
                </div>
                <!--Các sản phẩm -->
                <div class="table-wrapper u-s-m-b-60">
                    <table id="cartTable">
                        <tbody>
                            <!-- Sản phẩm 1  -->
                            <tr>
                                <td>
                                    <!-- Thông tin sản phẩm   -->
                                    <div class="cart-anchor-image">
                                        <a asp-controller="Product" asp-action="Details">
                                            <img src="~/images/cart/iphone15plus.jpg" alt="Product">
											<h6>Iphone 15 Pro Max</h6>
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <!-- GIá   -->
                                    <div class="cart-price"> 15.000.000đ </div>
                                </td>
                                <td>
                                    <!-- Thanh tăng giảm số lượng    -->
                                    <div class="cart-quantity">
                                        <div class="quantity">
                                            <input type="text" class="quantity-text-field" value="1">
                                            <a class="plus-a" data-max="1000">&#43;</a>
                                            <a class="minus-a" data-min="1">&#45;</a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <!-- Nút thùng rác đẻ xóa  -->
                                    <div class="action-wrapper">
                                        <button class="button button-outline-secondary fas fa-trash"></button>
                                    </div>
                                </td>
                            </tr>
                            <!-- Sản phẩm 2  -->
                            <tr>
                                <td>
                                    <div class="cart-anchor-image">
                                        <a asp-controller="Product" asp-action="Details">
                                            <img src="~/images/cart/laptop-asus.jpg" alt="Product">
											<h6>LapTop</h6>
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div class="cart-price"> 17.000.000đ </div>
                                </td>
                                <td>
                                    <div class="cart-quantity">
                                        <div class="quantity">
                                            <input type="text" class="quantity-text-field" value="1">
                                            <a class="plus-a" data-max="1000">&#43;</a>
                                            <a class="minus-a" data-min="1">&#45;</a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-wrapper">
                                        <button class="button button-outline-secondary fas fa-trash"></button>
                                    </div>
                                </td>
                            </tr>
                            <!-- Sản phẩm 3  -->
                            <tr>
                                <td>
                                    <div class="cart-anchor-image">
                                        <a asp-controller="Product" asp-action="Details">
                                            <img src="~/images/cart/redmi.jpg" alt="Product">
											<h6>Xiaomi Note 9 </h6>
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div class="cart-price"> 3.500.000đ </div>
                                </td>
                                <td>
                                    <div class="cart-quantity">
                                        <div class="quantity">
                                            <input type="text" class="quantity-text-field" value="1">
                                            <a class="plus-a" data-max="1000">&#43;</a>
                                            <a class="minus-a" data-min="1">&#45;</a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-wrapper">
                                        <button class="button button-outline-secondary fas fa-trash"></button>
                                    </div>
                                </td>
                            </tr>
                            <!-- Sản phẩm 4  -->
                            <tr>
                                <td>
                                    <div class="cart-anchor-image">
                                        <a asp-controller="Product" asp-action="Details">
                                            <img src="~/images/cart/laptop-dell.jpg" alt="Product">
											<h6>Dell Inspiron 15</h6>
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div class="cart-price"> 20.500.000đ </div>
                                </td>
                                <td>
                                    <div class="cart-quantity">
                                        <div class="quantity">
                                            <input type="text" class="quantity-text-field" value="1">
                                            <a class="plus-a" data-max="1000">&#43;</a>
                                            <a class="minus-a" data-min="1">&#45;</a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-wrapper">
                                        <button class="button button-outline-secondary fas fa-trash"></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Tổng tiền-->
                <div class="calculation u-s-m-b-60">
                    <div class="table-wrapper-2">
                        <table>
                            <tbody>
                                <tr>
                                    <td>
                                        <h3 style="color: red" class="calc-h3 u-s-m-b-0">Tống Tiền Hàng</h3>
                                    </td>
                                    <td id="totalPrice">
                                        <span class="calc-text">0đ</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Tổng tiền-->
                <!--Các sản phẩm -->
                <!-- Các nút dẫn -->
                <div class="coupon-continue-checkout u-s-m-b-60">

                    <div class="button-area">
                        <button style="border: 2px solid #292929" id="update-total-button" class="button button-outline-platinum continue" onclick="updateTotals()">Cập nhật tổng tiền</button>
                        <a asp-controller="Product" asp-action="Index" class="continue">Tiếp tục mua sắm</a>
                        <a asp-controller="CheckOut" asp-action="Index" class="checkout">Đi đến Thanh toán</a>
                    </div>
                </div>
                <!-- Các nút dẫn -->
            </div>

            <script>
                $(document).ready(function () {
                    // Lắng nghe sự kiện khi nhấn vào nút "Cập nhật tổng tiền"
                    $("#update-total-button").on("click", function () {
                        updateTotalPayment(); // Gọi hàm cập nhật tổng thanh toán
                    });
                });
            </script>
        </div>
    </div>
</div>
<!-- Thông tin về các sản phẩm trong giỏ  -->
<!-- Các sản phẩm mua kèm theo -->

<section class="section-maker">
    <div class="container">
        <div class="sec-maker-header text-center">
            <h3 class="sec-maker-h3">SẢN PHẨM MUA KÈM</h3>
        </div>
        <div class="slider-fouc">
            <!--Hiện tối đa 4 sản phẩm và có nút slide dể trượt qua  -->
            <div class="products-slider owl-carousel" data-item="4">
                <!-- Sản phẩm 1  -->
                <div class="item">
                    <div class="image-container">
                        <a class="item-img-wrapper-link" asp-controller="Product" asp-action="Details">
                            <img class="img-fluid" src="~/images/anhsp/tainghe.jpg" alt="Product">
                        </a>
                        <!-- Các nút khi hover vào ảnh sản phẩm  -->

                        <div class="item-action-behaviors">
                            <a class="item-quick-look" data-toggle="modal" href="#quick-view">Xem nhanh</a>
                            <a class="item-mail" href="javascript:void(0)">Mail</a>
                            <a class="item-addwishlist" href="javascript:void(0)">Thêm vào yêu thích</a>
                            <a class="item-addCart" href="javascript:void(0)">Thêm vào giỏ hàng</a>
                        </div>
                    </div>
                    <!--Thông tin sản phẩm  -->

                    <div class="item-content">
                        <div class="what-product-is">
                            <ul class="bread-crumb">
                                <li class="has-separator">
                                    <a asp-controller="Product" asp-action="Phone">Tai nghe</a>
                                </li>
                                <li>
                                    <a asp-controller="Product" asp-action="iPhone">Airpod</a>
                                </li>
                            </ul>
                            <h6 class="item-title">
                                <a asp-controller="Product" asp-action="Details"> Tai nghe Apple AirPods 3rd gen lightning charge </a>
                            </h6>
                            <div class="item-stars">
                                <div class='star' title="4.5 out of 5 - based on 82 Reviews">
                                    <span style='width:67px'></span>
                                </div>
                                <span>(82)</span>
                            </div>
                        </div>
                        <!-- Giá  -->

                        <div class="price-template">
                            <div class="item-new-price"> 4.090.000₫ </div>
                            <div class="item-old-price"> 5.390.000₫ </div>
                        </div>
                        <div style="text-align:end">
                            <span>Đã bán:</span>
                            <span class="data-sales">100</span>
                        </div>
                    </div>
                   <!-- Nhãn Hot  -->

                    <div class="tag hot">
                        <span>HOT</span>
                    </div>
                </div>
                 <!-- Sản phẩm 2  -->

                <div class="item">
                    <div class="image-container">
                        <a class="item-img-wrapper-link" asp-controller="Product" asp-action="Details">
                            <img class="img-fluid" src="~/images/anhsp/oplung.jpg" alt="Product">
                        </a>
                        <div class="item-action-behaviors">
                            <a class="item-quick-look" data-toggle="modal" href="#quick-view">Xem nhanh</a>
                            <a class="item-mail" href="javascript:void(0)">Mail</a>
                            <a class="item-addwishlist" href="javascript:void(0)">Thêm vào yêu thích</a>
                            <a class="item-addCart" href="javascript:void(0)">Thêm vào giỏ hàng</a>
                        </div>
                    </div>
                    <div class="item-content">
                        <div class="what-product-is">
                            <ul class="bread-crumb">
                                <li class="has-separator">
                                    <a asp-controller="Product" asp-action="Phone">Phụ kiện</a>
                                </li>
                                <li>
                                    <a asp-controller="Product" asp-action="iPhone">Ốp lưng</a>
                                </li>
                            </ul>
                            <h6 class="item-title">
                                <a asp-controller="Product" asp-action="Details">Ốp Lưng Trong Suốt MagSafe cho iPhone 15 Pro Max</a>
                            </h6>
                            <div class="item-stars">
                                <div class='star' title="4.4 out of 5 - based on 17 Reviews">
                                    <span style='width:67px'></span>
                                </div>
                                <span>(20)</span>
                            </div>
                        </div>
                        <div class="price-template">
                            <div class="item-new-price"> 990.000₫ </div>
                            <div class="item-old-price"> 1.429.000₫ </div>
                        </div>
                        <div style="text-align:end">
                            <span>Đã bán:</span>
                            <span class="data-sales">25</span>
                        </div>
                    </div>
                    <div class="tag hot">
                        <span>HOT</span>
                    </div>
                </div>
                <!-- Sản phẩm 3  -->

                <div class="item">
                    <div class="image-container">
                        <a class="item-img-wrapper-link" asp-controller="Product" asp-action="Details">
                            <img class="img-fluid" src="~/images/anhsp/cusac.jpg" alt="Product">
                        </a>
                        <div class="item-action-behaviors">
                            <a class="item-quick-look" data-toggle="modal" href="#quick-view">Xem nhanh</a>
                            <a class="item-mail" href="javascript:void(0)">Mail</a>
                            <a class="item-addwishlist" href="javascript:void(0)">Thêm vào yêu thích</a>
                            <a class="item-addCart" href="javascript:void(0)">Thêm vào giỏ hàng</a>
                        </div>
                    </div>
                    <div class="item-content">
                        <div class="what-product-is">
                            <ul class="bread-crumb">
                                <li class="has-separator">
                                    <a asp-controller="Product" asp-action="Phone">Phụ kiện</a>
                                </li>
                                <li>
                                    <a asp-controller="Product" asp-action="iPhone">Cục sạc</a>
                                </li>
                            </ul>
                            <h6 class="item-title">
                                <a asp-controller="Product" asp-action="Details">Sạc Apple 20W USB-C Power Adapter</a>
                            </h6>
                            <div class="item-stars">
                                <div class='star' title="4.4 out of 5 - based on 45 Reviews">
                                    <span style='width:67px'></span>
                                </div>
                                <span>(45)</span>
                            </div>
                        </div>
                        <div class="price-template">
                            <div class="item-new-price"> 459.000₫ </div>
                            <div class="item-old-price"> 790.000₫ </div>
                        </div>
                        <div style="text-align:end">
                            <span>Đã bán:</span>
                            <span class="data-sales">62</span>
                        </div>
                    </div>
                </div>
                <!-- Sản phẩm 4  -->

                <div class="item">
                    <div class="image-container">
                        <a class="item-img-wrapper-link" asp-controller="Product" asp-action="Details">
                            <img class="img-fluid" src="~/images/anhsp/daysac.jpg" alt="Product">
                        </a>
                        <div class="item-action-behaviors">
                            <a class="item-quick-look" data-toggle="modal" href="#quick-view">Xem nhanh</a>
                            <a class="item-mail" href="javascript:void(0)">Mail</a>
                            <a class="item-addwishlist" href="javascript:void(0)">Thêm vào yêu thích</a>
                            <a class="item-addCart" href="javascript:void(0)">Thêm vào giỏ hàng</a>
                        </div>
                    </div>
                    <div class="item-content">
                        <div class="what-product-is">
                            <ul class="bread-crumb">
                                <li class="has-separator">
                                    <a asp-controller="Product" asp-action="Phone">Phụ kiện </a>
                                </li>
                                <li>
                                    <a asp-controller="Product" asp-action="iPhone">Dây sạc</a>
                                </li>

                            </ul>
                            <h6 class="item-title">
                                <a asp-controller="Product" asp-action="Details">Cáp Apple Type-C to Type-C 2M MLL82ZP</a>
                            </h6>
                            <div class="item-stars">
                                <div class='star' title="4.8 out of 5 - based on 40 Reviews">
                                    <span style='width:72px'></span>
                                </div>
                                <span>(40)</span>
                            </div>
                        </div>
                        <div class="price-template">
                            <div class="item-new-price"> 650,000₫ </div>
                            <div class="item-old-price"> 790.000₫ </div>
                        </div>
                        <div style="text-align:end">
                            <span>Đã bán:</span>
                            <span class="data-sales">47</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Các sản phẩm mua kèm theo -->
<!-- Nội dung chính của giỏ hàng -->


<script>
    // Xóa thùng rác
    document.addEventListener("DOMContentLoaded", function () {
        // Chọn các nút xóa
        var deleteButtons = document.querySelectorAll('.fa-trash');

        deleteButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                var row = this.closest('tr'); // tìm tag cha 
                var price = row.querySelector('.cart-price').textContent.trim(); // lấy giá trị về giá 
                var totalPriceElement = document.getElementById('totalPrice');
                var totalPaymentElement = document.getElementById('totalPayment');

                var totalPriceText = totalPriceElement.textContent.trim();
                var totalPrice = parseInt(totalPriceText.replace('đ', '').replace(/\D/g, ''), 10); // chuyển tổng giá về dạng số

                // Xóa dòng đó
                row.remove();

                // Cập nhật tổng giá 
                totalPrice -= parseInt(price.replace('đ', '').replace(/\D/g, ''), 10);
                totalPriceElement.textContent = formatCurrency(totalPrice);

                // Cập nhật tổng chi trả
                totalPaymentElement.textContent = formatCurrency(totalPrice); 
            });
        });

        //Hàm để định dạng loại tiền tệ
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }
    });
</script>
<script>
    // Hàm tính tổng giá 
    function calculateTotalPrice() {
        let totalPrice = 0;
        const cartItems = document.querySelectorAll('#cartTable tbody tr');
        cartItems.forEach(function (item) {
            const priceStr = item.querySelector('.cart-price').textContent.trim();
            const price = parseFloat(priceStr.replace('đ', '').replace(/\D/g, '').trim());
            const quantity = parseInt(item.querySelector('.quantity-text-field').value.trim());
            totalPrice += price * quantity;
        });
        return totalPrice;
    }

    // Hàm cập nhật tổng giá
    function updateTotals() {
        const totalPrice = calculateTotalPrice();

        document.getElementById('totalPrice').textContent = totalPrice.toLocaleString() + 'đ';
        document.getElementById('totalPayment').textContent = totalPrice.toLocaleString() + 'đ'; // Update total payment to match total price
    }

    // Quan sát sự thay dổi số lượng
    const quantityInputs = document.querySelectorAll('.quantity-text-field');
    quantityInputs.forEach(function (input) {
        input.addEventListener('input', function () {
            updateTotals();
        });
    });

    // Cập nhật lại nhá 
    updateTotals();
</script>
<script>
    // Hàm cập nhật tổng cộng
    function updateTotals() {
        const totalPrice = calculateTotalPrice();
        const totalPayment = totalPrice; // Tổng thanh toán sẽ bằng tổng giá sản phẩm

        document.getElementById('totalPrice').textContent = totalPrice.toLocaleString() + 'đ';
        document.getElementById('totalPayment').textContent = totalPayment.toLocaleString() + 'đ';
    }
</script>
